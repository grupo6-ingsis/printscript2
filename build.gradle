def versionFile = file('version.txt')
def version = versionFile.text.trim()

tasks.register('bumpVersion') {
    doLast {
        def matcher = (version =~ /(\d+)\.(\d+)\.(\d+)/)
        if (matcher.find()) {
            def major = matcher.group(1).toInteger()
            def minor = matcher.group(2).toInteger()
            def patch = matcher.group(3).toInteger() + 1
            def newVersion = "${major}.${minor}.${patch}"
            versionFile.text = newVersion
            println "Version updated to ${newVersion}"
        } else {
            throw new GradleException("No se encontrÃ³ versiÃ³n vÃ¡lida en version.txt")
        }
    }
}

ext {
    versionCode = version
}

subprojects {
    tasks.matching { it.name == 'publish' }.configureEach {
        dependsOn rootProject.tasks.named('bumpVersion')
    }
}

allprojects {
    version = rootProject.ext.versionCode
}